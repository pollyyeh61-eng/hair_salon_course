<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾é«®å‰µæ¥­éŠæˆ²åŒ–èª²ç¨‹</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        /* ==================== å¤¢å¹»ç‚«å½©ä¸»é¡Œè¨­å®š ==================== */
        :root {
            --primary-purple: #8a2be2;
            --soft-purple: #b388ff;
            --deep-purple: #4b0082;
            --magic-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --glass-bg: rgba(255, 255, 255, 0.85);
            --neon-glow: 0 0 15px rgba(138, 43, 226, 0.5);
        }

        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            margin: 0;
            padding: 20px;
            /* ç‚«å½©èƒŒæ™¯ */
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: var(--deep-purple);
            line-height: 1.6;
            min-height: 100vh;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1000px;
            margin: 20px auto;
            background-color: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 40px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        h1, h2, h3 {
            color: var(--deep-purple);
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
        }

        /* ç´«è‰²ç³»æŒ‰éˆ• */
        button {
            background: var(--magic-gradient);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: var(--neon-glow);
        }

        button:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(138, 43, 226, 0.8);
        }

        /* ==================== å„€è¡¨æ¿æ¨£å¼ ==================== */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 25px;
            border-bottom: 2px dashed var(--soft-purple);
            margin-bottom: 30px;
        }

        .user-level {
            font-weight: bold;
            color: var(--primary-purple);
            background: rgba(138, 43, 226, 0.1);
            padding: 5px 15px;
            border-radius: 20px;
        }

        .points-display {
            font-size: 2.5em;
            font-weight: 900;
            color: var(--primary-purple);
        }

        /* ç¸½é€²åº¦æ¢ */
        .progress-bar-container {
            height: 15px;
            width: 250px;
            background-color: #ddd;
            border-radius: 10px;
            margin-top: 10px;
            overflow: hidden;
            border: 2px solid white;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff8a00, #da1b60);
            transition: width 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* ==================== èª²ç¨‹å¡ç‰‡å„ªåŒ– ==================== */
        .modules-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }

        .module-card {
            background: white;
            border-radius: 18px;
            padding: 20px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .module-card:hover {
            transform: translateY(-10px);
            border-color: var(--soft-purple);
            box-shadow: 0 15px 30px rgba(138, 43, 226, 0.2);
        }

        .module-card.status-completed { background-color: #f3e5f5; border-left: 8px solid #9c27b0; }
        .module-card.status-in-progress { border-left: 8px solid #ff9800; }
        .module-card.status-not-started { border-left: 8px solid #bdbdbd; }

        /* å¡ç‰‡å…§çš„å°é€²åº¦æ¢ */
        .card-mini-progress {
            height: 6px;
            background: #eee;
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }
        .card-mini-progress-fill {
            height: 100%;
            background: var(--primary-purple);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* ==================== è­‰æ›¸èˆ‡å½±ç‰‡é é¢ ==================== */
        #videoPlayer {
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .certificate-container {
            background: white url('https://www.transparenttextures.com/patterns/white-paper.png');
            border: 15px double var(--primary-purple);
            padding: 40px;
            color: #333;
        }

        .recipient-name {
            color: var(--primary-purple) !important;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="dashboard">
            <div class="dashboard-header">
                <div class="user-info">
                    <h2>âœ¨ æ­¡è¿å›ä¾†ï¼Œ<span id="userNameDisplay" style="color:var(--primary-purple)">è¨ªå®¢</span> âœ¨</h2>
                    <p class="user-level" id="userLevelDisplay">è¼‰å…¥ä¸­...</p>
                </div>
                <div class="progress-info">
                    <span class="points-display">
                        <span id="userPointsDisplay">0</span> <small style="font-size: 0.4em">PTS</small>
                    </span>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progressBar" style="width: 0%;"></div>
                    </div>
                    <p style="font-size: 0.8em; margin: 5px 0 0 0;">ç¸½æˆé•·é€²åº¦</p>
                </div>
            </div>

            <h3 style="margin-bottom: 20px;">ğŸ”® æ‚¨çš„å‰µæ¥­ä¿®ç…‰è·¯å¾‘</h3>
            <main class="modules-list" id="modulesList">
                </main>
        </div>

        <div id="modulePage" style="display:none;">
            <button id="backToDashboardBtn" style="margin-bottom: 20px;">ğŸ”® è¿”å›ä¿®ç…‰æ¸…å–®</button>
            <h2 id="moduleTitle" style="color: var(--primary-purple);"></h2>
            <p id="moduleSubtitle"></p>
            <div class="video-player-container">
                <video id="videoPlayer" controls preload="metadata"></video>
            </div>
            <p style="text-align: center; color: var(--primary-purple); font-weight: bold; margin-top: 10px;">
                ğŸ’¡ è§€çœ‹è‡³ 100% å³å¯è‡ªå‹•ç²å¾—å‰µæ¥­é»æ•¸
            </p>
        </div>

        <div id="certificatePage" style="display:none; flex-direction: column; align-items: center;">
            <div class="certificate-container" id="certificateContent">
                <div class="certificate-content" style="text-align: center;">
                    <h1 style="font-size: 3em;">ğŸ“ å‰µæ¥­å°å¸«çµæ¥­è­‰æ›¸</h1>
                    <p style="font-size: 1.5em;">ç‰¹æ­¤è­‰æ˜</p>
                    <h2 class="recipient-name" id="certificateUserName" style="font-size: 3.5em; margin: 20px 0;"></h2>
                    <p style="font-size: 1.2em;">å·²æˆåŠŸä¿®ç•¢</p>
                    <h3 id="certificateCourseName" style="font-size: 2em; color: var(--deep-purple);"></h3>
                    <p>æ­£å¼å…·å‚™ç¾é«®æ²™é¾ç¶“ç‡Ÿä¹‹åˆéšå°å¸«è³‡æ ¼</p>
                    <div style="margin-top: 50px; display: flex; justify-content: space-around;">
                        <div>
                            <div style="border-bottom: 2px solid #333; width: 150px; margin-bottom: 10px;"></div>
                            <p>æ•¸ä½æ ¡é•·ç°½ç½²</p>
                        </div>
                        <div>
                            <p id="certificateCompletionDate"></p>
                            <p>é ’ç™¼æ—¥æœŸ</p>
                        </div>
                    </div>
                </div>
            </div>
            <div style="margin-top: 20px;">
                <button id="downloadCertificateBtn">ğŸ–¼ï¸ ä¸‹è¼‰æ¦®è€€è­‰æ›¸</button>
                <button id="backFromCertificateBtn" style="background: #666; margin-left: 10px;">è¿”å›é¦–é </button>
            </div>
        </div>
    </div>

    <script>
        // è³‡æ–™çµæ§‹ä¿æŒä¸è®Šï¼Œä½†å¢åŠ é€²åº¦æ¢é‚è¼¯æ¸²æŸ“
        let currentUserState = {
            userId: 'guest-user',
            userName: 'ç¾é«®å‰µæ¥­å®¶',
            points: 0,
            level: 'åˆéšå­¸å¾’',
            currentModuleIndex: -1,
            modules: [
                { title: '0. ç‚ºä½•è¦å‰µæ¥­', subtitle: 'äº†è§£è‡ªå·±é©åˆå‰µæ¥­å—?', points: 50, completed: false, videoUrl: 'https://drive.google.com/file/d/1gbZn2DTvHiE2B_G06nERXb-Q7AuQvFIh/preview', videoProgress: 0 },
                { title: '1. å¸‚å ´èª¿æŸ¥', subtitle: 'æˆ‘çš„ç«¶çˆ­å°æ‰‹æ˜¯èª°ï¼Ÿ', points: 50, completed: false, videoUrl: 'https://drive.google.com/file/d/1U8qQb6Ob_0pLR-KxtTLDnYcuh0fqqFtW/preview', videoProgress: 0 },
                { title: '2. ç›®æ¨™å®¢ç¾¤åˆ†æ', subtitle: 'äº†è§£æ½›åœ¨é¡§å®¢', points: 50, completed: false, videoUrl: 'https://drive.google.com/file/d/1K4_D47lq7gVnBl-OFApHuedFwgC3KAjV/preview', videoProgress: 0 },
                { title: '3. ç«¶çˆ­è€…ç ”ç©¶', subtitle: 'åˆ¶å®šæœ‰æ•ˆç­–ç•¥', points: 50, completed: false, videoUrl: 'https://drive.google.com/file/d/1O5YKOSNwJkiSZS_4sjJvEI0dwKD-CxnR/preview', videoProgress: 0 },
                { title: '4. è¡Œæ¥­è¶¨å‹¢èˆ‡éœ€æ±‚è©•ä¼°', subtitle: 'äº†è§£å¸‚å ´åŠéœ€æ±‚è€…', points: 50, completed: false, videoUrl: 'https://drive.google.com/file/d/1cC2envJ3VySRqNahyUsLbST1U5Nw-T2I/preview', videoProgress: 0 },
                { title: '5. å°ˆæ¥­åŒ–ç¾é«®å®šä½', subtitle: 'å…·å‚™ç¨ç‰¹æ€§', points: 50, completed: false, videoUrl: 'https://drive.google.com/file/d/1mx6dCQx22q7MVAMaiH3B5570xDGb8etg/preview', videoProgress: 0 },
                { title: '6. é¸å€èˆ‡ä½ˆç½®', subtitle: 'é¸å€èˆ‡ä½ˆç½®æ˜¯æ²™é¾å‰µæ¥­çš„åŸºçŸ³', points: 50, completed: false, videoUrl: 'https://drive.google.com/file/d/1kvB1EkXtp1xxtduubgPEPKtc_uJu7eK4/preview', videoProgress: 0 },
                { title: '7. æœå‹™å°ˆæ¡ˆ', subtitle: 'å“ç‰Œå°±åƒæ˜¯ä½ çš„è‡‰', points: 50, completed: false, videoUrl: 'https://drive.google.com/file/d/11M2Wpx8cTDlYxyzImPhtniOZUhLXtdiH/preview', videoProgress: 0 },
                { title: '8. ä¾›æ‡‰éˆç®¡ç†', subtitle: 'æå‡æ•ˆç‡ã€é™ä½æˆæœ¬', points: 100, completed: false, videoUrl: 'https://drive.google.com/file/d/1Aj3GeAjIP561kZbvQ34erVizzbJ5GcZq/preview', videoProgress: 0 },
                { title: '9. äººåŠ›è³‡æºè¦åŠƒ', subtitle: 'äººå“¡æ‹›è˜åˆ°åœ˜éšŠç®¡ç†ç­–ç•¥', points: 50, completed: false, videoUrl: 'https://drive.google.com/file/d/16yrBQAjmQYj5fwOPvvZ5m8LRE287YWQ2/preview', videoProgress: 0 },
                { title: '10. é«˜ç«¯å®¢æˆ¶æœå‹™', subtitle: 'ç‚ºé«˜ç«¯å®¢æˆ¶æä¾›å°ˆå±¬æœå‹™', points: 50, completed: false, videoUrl: 'https://drive.google.com/file/d/1kXaekwIciXsdwGy4pKnCyuMkohfOzvo_/preview', videoProgress: 0 },
                { title: '11. æ³•å¾‹èˆ‡åˆè¦', subtitle: 'é–‹è¨­æ²™é¾æ‰€éœ€çš„æ³•å¾‹çŸ¥è­˜', points: 50, completed: false, videoUrl: 'https://drive.google.com/file/d/1LmhYPbc-jUBJhtUWv11kIBoXy60yizrJ/preview', videoProgress: 0 },
                { title: '12. è²¡å‹™ç®¡ç†æµç¨‹', subtitle: 'å‰µæ¥­çš„æ ¸å¿ƒç’°ç¯€', points: 100, completed: false, videoUrl: 'https://drive.google.com/file/d/18GQ8LguusbO7nKHRNl9dwdzFmRi1H-Be/preview', videoProgress: 0 },
                { title: '13. ä½æˆæœ¬å‰µæ¥­', subtitle: 'å¦‚ä½•åšä½æˆæœ¬å‰µæ¥­', points: 100, completed: false, videoUrl: 'https://drive.google.com/file/d/1gY-HmrC_qWmHTOJJ3vV_lnMiN32_RpEH/preview', videoProgress: 0 },
                { title: '14. ç²å®¢è®Šç¾', subtitle: 'ä½æˆæœ¬è¡ŒéŠ·ä¹Ÿèƒ½ç²å®¢è®Šç¾', points: 100, completed: false, videoUrl: 'https://drive.google.com/file/d/1XWDIlKWw_ueGTIhfW8tld2KPp1jD_TBt/preview', videoProgress: 0 }
            ],
            certificateID: null
        };

        const playerLevelMap = [
            { threshold: 0, name: 'ğŸ”® åˆéšå­¸å¾’' },
            { threshold: 300, name: 'âš¡ ä¸­éšç¶“ç‡Ÿè€…' },
            { threshold: 600, name: 'ğŸ‘‘ é«˜éšç­–ç•¥å¸«' },
            { threshold: 1000, name: 'ğŸŒŒ å‰µæ¥­å°å¸«' }
        ];

        // å…ƒç´ é¸å–å™¨
        const dashboardDiv = document.getElementById('dashboard');
        const modulePageDiv = document.getElementById('modulePage');
        const certificatePageDiv = document.getElementById('certificatePage');
        const modulesList = document.getElementById('modulesList');
        const videoPlayer = document.getElementById('videoPlayer');

        // æ¸²æŸ“ç•«é¢
        function renderDashboard() {
            document.getElementById('userNameDisplay').textContent = currentUserState.userName;
            document.getElementById('userPointsDisplay').textContent = currentUserState.points;
            
            // æ›´æ–°ç­‰ç´š
            const currentLevel = [...playerLevelMap].reverse().find(l => currentUserState.points >= l.threshold);
            currentUserState.level = currentLevel ? currentLevel.name : playerLevelMap[0].name;
            document.getElementById('userLevelDisplay').textContent = currentUserState.level;

            // æ›´æ–°ç¸½é€²åº¦æ¢ (ä»¥ 1000 é»ç‚ºæ»¿åˆ†ç›®æ¨™)
            const totalTarget = 1000;
            const progress = (currentUserState.points / totalTarget) * 100;
            document.getElementById('progressBar').style.width = `${Math.min(100, progress)}%`;

            // æ¸²æŸ“åˆ—è¡¨
            modulesList.innerHTML = '';
            currentUserState.modules.forEach((m, i) => {
                const card = document.createElement('div');
                const statusClass = m.completed ? 'status-completed' : (m.videoProgress > 0 ? 'status-in-progress' : 'status-not-started');
                
                card.className = `module-card ${statusClass}`;
                card.innerHTML = `
                    <div>
                        <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                            <h4 style="margin:0; color:var(--deep-purple);">${m.title}</h4>
                            <span style="font-size:0.7em; padding:3px 8px; border-radius:10px; background:rgba(0,0,0,0.05);">
                                ${m.completed ? 'âœ… å·²å®Œæˆ' : (m.videoProgress > 0 ? 'ğŸ•’ å­¸ç¿’ä¸­' : 'ğŸ”’ æœªé–‹å§‹')}
                            </span>
                        </div>
                        <p style="font-size:0.85em; color:#666; margin:10px 0;">${m.subtitle}</p>
                    </div>
                    <div>
                        <div class="card-mini-progress">
                            <div class="card-mini-progress-fill" style="width: ${m.videoProgress}%"></div>
                        </div>
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span style="font-size:0.8em; font-weight:bold; color:var(--primary-purple);">+${m.points} PTS</span>
                            <span style="font-size:0.7em; color:#999;">${m.videoProgress}%</span>
                        </div>
                    </div>
                `;
                card.onclick = () => openModule(i);
                modulesList.appendChild(card);
            });

            // æª¢æŸ¥æ˜¯å¦é”æˆçµæ¥­
            const allDone = currentUserState.modules.every(m => m.completed);
            if (allDone && !currentUserState.certificateID) {
                setTimeout(showCertificate, 1000);
            }
        }

        function openModule(index) {
            currentUserState.currentModuleIndex = index;
            const module = currentUserState.modules[index];
            
            document.getElementById('moduleTitle').textContent = module.title;
            document.getElementById('moduleSubtitle').textContent = module.subtitle;
            videoPlayer.src = module.videoUrl;
            
            videoPlayer.onloadedmetadata = () => {
                if (module.videoProgress > 0 && module.videoProgress < 95) {
                    if (confirm(`æ˜¯å¦å¾ä¸Šæ¬¡çœ‹åˆ°çš„ ${module.videoProgress}% ç¹¼çºŒï¼Ÿ`)) {
                        videoPlayer.currentTime = (module.videoProgress / 100) * videoPlayer.duration;
                    }
                }
                videoPlayer.play();
            };

            videoPlayer.ontimeupdate = () => {
                const prog = Math.floor((videoPlayer.currentTime / videoPlayer.duration) * 100);
                if (prog > module.videoProgress) {
                    module.videoProgress = prog;
                    if (prog % 10 === 0) saveUserState(); // æ¯ 10% å­˜æª”ä¸€æ¬¡
                }
            };

            videoPlayer.onended = () => {
                module.videoProgress = 100;
                if (!module.completed) {
                    module.completed = true;
                    currentUserState.points += module.points;
                    alert(`ğŸŠ å¤ªæ£’äº†ï¼ä½ å®Œæˆäº†ä¿®ç…‰ï¼Œç²å¾—äº† ${module.points} é»ï¼`);
                }
                saveUserState();
                renderDashboard();
            };

            showPage('module');
        }

        function showPage(id) {
            dashboardDiv.style.display = id === 'dashboard' ? 'block' : 'none';
            modulePageDiv.style.display = id === 'module' ? 'block' : 'none';
            certificatePageDiv.style.display = id === 'certificate' ? 'flex' : 'none';
        }

        function showCertificate() {
            currentUserState.certificateID = 'CERT-' + Date.now();
            saveUserState();
            document.getElementById('certificateUserName').textContent = currentUserState.userName;
            document.getElementById('certificateCourseName').textContent = "ç¾é«®æ²™é¾å‰µæ¥­æˆ°ç•¥èª²ç¨‹";
            document.getElementById('certificateCompletionDate').textContent = new Date().toLocaleDateString();
            showPage('certificate');
        }

        function saveUserState() {
            localStorage.setItem('hairGame_v2', JSON.stringify(currentUserState));
        }

        function loadUserState() {
            const saved = localStorage.getItem('hairGame_v2');
            if (saved) currentUserState = JSON.parse(saved);
        }

        // åˆå§‹åŒ–äº‹ä»¶
        window.onload = () => {
            loadUserState();
            renderDashboard();
        };

        document.getElementById('backToDashboardBtn').onclick = () => {
            videoPlayer.pause();
            renderDashboard();
            showPage('dashboard');
        };

        document.getElementById('backFromCertificateBtn').onclick = () => showPage('dashboard');

        document.getElementById('downloadCertificateBtn').onclick = () => {
            html2canvas(document.getElementById('certificateContent')).then(canvas => {
                const link = document.createElement('a');
                link.download = 'å‰µæ¥­çµæ¥­è­‰æ›¸.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        };
    </script>
</body>
</html>
